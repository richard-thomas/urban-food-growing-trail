/* UrbanFoodTrail - v1.0.0
 * https://github.com/richard-thomas/urban-food-growing-trail
 */
L.Control.Sidebar=L.Control.extend({includes:L.Mixin.Events,options:{closeButton:!0,position:"left",autoPan:!0},initialize:function(t,e){L.setOptions(this,e);var o=this._contentContainer=L.DomUtil.get(t);o.parentNode.removeChild(o);var n="leaflet-",i=this._container=L.DomUtil.create("div",n+"sidebar "+this.options.position);if(L.DomUtil.addClass(o,n+"control"),i.appendChild(o),this.options.closeButton){var a=this._closeButton=L.DomUtil.create("a","close",i);a.innerHTML="&times;"}},addTo:function(t){var e=this._container,o=this._contentContainer;if(this.options.closeButton){var n=this._closeButton;L.DomEvent.on(n,"click",this.hide,this)}L.DomEvent.on(e,"transitionend",this._handleTransitionEvent,this).on(e,"webkitTransitionEnd",this._handleTransitionEvent,this);var i=t._controlContainer;i.insertBefore(e,i.firstChild),this._map=t;var a=L.DomEvent.stopPropagation,s=L.DomEvent._fakeStop||a;return L.DomEvent.on(o,"contextmenu",a).on(o,"click",s).on(o,"mousedown",a).on(o,"touchstart",a).on(o,"dblclick",s).on(o,"mousewheel",a).on(o,"MozMousePixelScroll",a),this},removeFrom:function(t){this.hide();var e=this._contentContainer,o=t._controlContainer;o.removeChild(this._container),this._map=null;var n=L.DomEvent.stopPropagation,i=L.DomEvent._fakeStop||n;if(L.DomEvent.off(e,"contextmenu",n).off(e,"click",i).off(e,"mousedown",n).off(e,"touchstart",n).off(e,"dblclick",i).off(e,"mousewheel",n).off(e,"MozMousePixelScroll",n),L.DomEvent.off(container,"transitionend",this._handleTransitionEvent,this).off(container,"webkitTransitionEnd",this._handleTransitionEvent,this),this._closeButton&&this._close){var a=this._closeButton;L.DomEvent.off(a,"click",this.hide,this)}return this},isVisible:function(){return L.DomUtil.hasClass(this._container,"visible")},show:function(){this.isVisible()||(L.DomUtil.addClass(this._container,"visible"),this.options.autoPan&&this._map.panBy([-this.getOffset()/2,0],{duration:.5}),this.fire("show"))},hide:function(t){this.isVisible()&&(L.DomUtil.removeClass(this._container,"visible"),this.options.autoPan&&this._map.panBy([this.getOffset()/2,0],{duration:.5}),this.fire("hide")),t&&L.DomEvent.stopPropagation(t)},toggle:function(){this.isVisible()?this.hide():this.show()},getContainer:function(){return this._contentContainer},getCloseButton:function(){return this._closeButton},setContent:function(t){return this.getContainer().innerHTML=t,this},getOffset:function(){return"right"===this.options.position?-this._container.offsetWidth:this._container.offsetWidth},_handleTransitionEvent:function(t){("left"==t.propertyName||"right"==t.propertyName)&&this.fire(this.isVisible()?"shown":"hidden")}}),L.control.sidebar=function(t,e){return new L.Control.Sidebar(t,e)},function(t,e){"function"==typeof define&&define.amd?define(["leaflet"],e):"object"==typeof exports?module.exports=e(require("leaflet")):t.L.Control.DefaultExtent=e(t.L)}(this,function(t){return function(){"use strict";return t.Control.DefaultExtent=t.Control.extend({options:{position:"topleft",text:"Default Extent",title:"Zoom to default extent",className:"leaflet-control-defaultextent"},onAdd:function(t){return this._map=t,this._initLayout()},setCenter:function(t){return this._center=t,this},setZoom:function(t){return this._zoom=t,this},_initLayout:function(){var e=t.DomUtil.create("div","leaflet-bar "+this.options.className);return this._container=e,this._fullExtentButton=this._createExtentButton(e),t.DomEvent.disableClickPropagation(e),this._map.whenReady(this._whenReady,this),this._container},_createExtentButton:function(){var e=t.DomUtil.create("a",this.options.className+"-toggle",this._container);return e.href="#",e.innerHTML=this.options.text,e.title=this.options.title,t.DomEvent.on(e,"mousedown dblclick",t.DomEvent.stopPropagation).on(e,"click",t.DomEvent.stop).on(e,"click",this._zoomToDefault,this),e},_whenReady:function(){return this._center||(this._center=this._map.getCenter()),this._zoom||(this._zoom=this._map.getZoom()),this},_zoomToDefault:function(){this._map.setView(this._center,this._zoom)}}),t.Map.addInitHook(function(){this.options.defaultExtentControl&&this.addControl(new t.Control.DefaultExtent)}),t.control.defaultExtent=function(e){return new t.Control.DefaultExtent(e)},t.Control.DefaultExtent}()}),function(){"use strict";L.Control.Button=L.Control.extend({options:{position:"topright",text:"Icon Alt Text",title:"(Hover description)",className:"class-for-css-image-selection",callback:function(){}},onAdd:function(t){this._map=t;var e=L.DomUtil.create("div","leaflet-bar "+this.options.className);this._container=e;var o=L.DomUtil.create("a",this.options.className,this._container);return o.href="#",o.innerHTML=this.options.text,o.title=this.options.title,L.DomEvent.on(o,"mousedown dblclick",L.DomEvent.stopPropagation).on(o,"click",L.DomEvent.stop).on(o,"click",this.options.callback,this),L.DomEvent.disableClickPropagation(e),this._container}}),L.control.button=function(t){return new L.Control.Button(t)}}(),function(){"use strict";L.Control.LocateMe=L.Control.extend({options:{position:"topleft",text:"Locate Me!",title:"Pan to current location",className:"leaflet-control-locateme"},onAdd:function(t){return this._map=t,this._initLayout()},_initLayout:function(){this._meMarkerExists=!1;var t=L.DomUtil.create("div","leaflet-bar "+this.options.className);return this._container=t,this._locateMeButton=this._createLocateButton(t),L.DomEvent.disableClickPropagation(t),this._map.whenReady(this._whenReady,this),this._container},_createLocateButton:function(){var t=L.DomUtil.create("a",this.options.className+"-toggle",this._container);return t.href="#",t.innerHTML=this.options.text,t.title=this.options.title,L.DomEvent.on(t,"mousedown dblclick",L.DomEvent.stopPropagation).on(t,"click",L.DomEvent.stop).on(t,"click",this._panToMe,this),t},_onLocationFound:function(t){var e=t.accuracy/2,o="You are within "+e+" metres of this point";this._myLatlng=t.latlng,this._meMarkerExists===!1?(this._meMarker=L.marker(t.latlng).addTo(this._map).bindPopup(o),this._meCircle=L.circle(t.latlng,e).addTo(this._map),this._meMarkerExists=!0):(this._meMarker.setLatLng(t.latlng).update(),this._meMarker.setPopupContent(o),this._meCircle.setLatLng(t.latlng),this._meCircle.setRadius(e))},_onLocationError:function(t){alert(t.message)},_whenReady:function(){return this._map.on("locationfound",this._onLocationFound,this),this._map.on("locationerror",this._onLocationError),this._map.locate({enableHighAccuracy:!0,watch:!0,maximumAge:5e3}),this},_panToMe:function(){"undefined"!=typeof this._myLatlng&&this._map.setView(this._myLatlng)}}),L.Map.addInitHook(function(){this.options.locateMeControl&&this.addControl(new L.Control.LocateMe)})}(),trailGeoJson={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[-2.5805962,51.4493936,0]},properties:{name:"tm-plat3",styleUrl:"#icon-503-DB4436-nodesc",styleHash:"-3b37c65d"}},{type:"Feature",geometry:{type:"Point",coordinates:[-2.5825918,51.4490994,0]},properties:{name:"tm-outdoor-beds",styleUrl:"#icon-503-DB4436-nodesc",styleHash:"-3b37c65d"}},{type:"Feature",geometry:{type:"Point",coordinates:[-2.5862074,51.449514,0]},properties:{name:"temple-st-100",styleUrl:"#icon-503-DB4436-nodesc",styleHash:"-3b37c65d"}},{type:"Feature",geometry:{type:"Point",coordinates:[-2.5884323,51.449061,0]},properties:{name:"chatterton-birthplace",styleUrl:"#icon-503-DB4436-nodesc",styleHash:"-3b37c65d"}},{type:"Feature",geometry:{type:"Point",coordinates:[-2.5899263,51.4486598,0]},properties:{name:"mary-redcliffe",styleUrl:"#icon-503-DB4436-nodesc",styleHash:"-3b37c65d"}},{type:"Feature",geometry:{type:"Point",coordinates:[-2.5836271,51.4487267,0]},properties:{name:"engine-shed",styleUrl:"#icon-503-DB4436-nodesc",styleHash:"-3b37c65d"}},{type:"Feature",geometry:{type:"Point",coordinates:[-2.5930631,51.4495039,0]},properties:{name:"hole-in-the-wall",styleUrl:"#icon-503-DB4436-nodesc",styleHash:"-3b37c65d"}},{type:"Feature",geometry:{type:"Point",coordinates:[-2.5959492,51.4504283,0]},properties:{name:"destination-bristol",styleUrl:"#icon-503-DB4436-nodesc",styleHash:"-3b37c65d"}},{type:"Feature",geometry:{type:"Point",coordinates:[-2.59988,51.4506005,0]},properties:{name:"anchor-square",styleUrl:"#icon-503-DB4436-nodesc",styleHash:"-3b37c65d"}},{type:"Feature",geometry:{type:"Point",coordinates:[-2.6009005,51.4498199,0]},properties:{name:"millenium-square",styleUrl:"#icon-503-DB4436-nodesc",styleHash:"-3b37c65d"}},{type:"Feature",geometry:{type:"LineString",coordinates:[[-2.5899263,51.4486598,0],[-2.5901878,51.4485745,0],[-2.5905901,51.4486147,0],[-2.591089,51.4492632,0],[-2.5925857,51.4494872,0],[-2.5927037,51.4494304,0],[-2.5930631,51.4495039,0],[-2.5937498,51.4498048,0],[-2.5946939,51.4505202,0],[-2.5964239,51.4506565,0],[-2.5963797,51.4508011,0],[-2.5973225,51.4508846,0],[-2.5975169,51.4500138,0],[-2.59988,51.4506005,0],[-2.5999832,51.4501241,0],[-2.6009005,51.4498199,0]]},properties:{name:"Line 11"}},{type:"Feature",geometry:{type:"LineString",coordinates:[[-2.5805962,51.4493936,0],[-2.5810361000000004,51.4496544,0],[-2.5811152,51.4496193,0],[-2.5812373,51.4496878,0],[-2.5825703,51.4490768,0],[-2.5835507,51.4486447,0],[-2.5845438,51.44914870000001,0],[-2.584767,51.4493936,0],[-2.5850071,51.44940950000001,0],[-2.5851808,51.449521000000004,0],[-2.5861846,51.4497504,0],[-2.5862194,51.4492841,0],[-2.5865922000000006,51.4491855,0],[-2.5874558,51.4492224,0],[-2.5878418,51.4491558,0],[-2.5884262,51.44919310000001,0],[-2.5885113,51.4490604,0],[-2.5886172,51.4489921,0],[-2.5888289,51.4489961,0],[-2.5890646000000004,51.4489003,0],[-2.5896809,51.44899620000001,0],[-2.5899263,51.4486598,0]]},properties:{name:"walk-route"}}]},trailInfo={"tm-plat3":{fullname:"Platform 3, Temple Meads",summary:"A work in progress: an apple tree, a blackcurrant bush (as Ribena was first made in Bristol!) and rhubarb",link:"platform-3-temple-meads"},"tm-outdoor-beds":{fullname:"Outdoor Beds, Temple Meads",summary:"Raised bed by the Passenger Shed at Temple Meads: an immensely sunny aspect and so needed planting with a crop that would cope with some drought",link:"temple-meads-concourse"},"engine-shed":{fullname:"Engine Shed Wicking Bed",summary:"Wicking bed outside the Engine Shed, designed to only require watering once every few weeks",link:"the-wicking-bed"},"temple-st-100":{fullname:"100 Temple Street",summary:"Brick raised beds in front of Bristol City Council offices",link:"100-temple-street"},"chatterton-birthplace":{fullname:"Thomas Chattertonâ€™s Birthplace",summary:"Beds for humans and bees; designed on permaculture principles",link:"thomas-chattertons-birthplace-garden"},"mary-redcliffe":{fullname:"St Mary Redcliffe Fruit Garden",summary:"Trees and shrubs adjacent to steps up to the church",link:"st-mary-redcliffe-fruit-garden"},"hole-in-the-wall":{fullname:"The Grove",summary:"Beds adjacent to the 'Hole in the Wall' public house",link:""},"destination-bristol":{fullname:"Destination Bristol",summary:"(TBD)"},"anchor-square":{fullname:"Anchor Square Herb Bed",summary:"Raised planter filled with perennial herbs in front of @Bristol",link:"anchor-square-herb-bed"},"millenium-square":{fullname:"Millenium Square Urban Allotments",summary:"5 raised beds in Millennium Square",link:"millennium-square-urban-allotments"}};var trail=function(){function t(){for(var t=0;t<p.length;t++)p[t].style.display="none"}function e(){m.innerHTML="",t(),document.getElementById("intro-info").style.display="inline",h.show()}function o(e){t(),m.innerHTML=trailInfo[e].fullname;var o=document.getElementById(e+"-info");o&&(o.style.display="inline");var n=trailInfo[e].link;n&&(y.href="http://ediblebristol.org.uk/urban-food-growing-trail-a-bristol-2015-project/"+n,f.style.display="inline")}function n(){g.isVisible()?g.hide():(h.hideOnAuto(),g.show())}function i(t){var e=t.target.getAttribute("data-loc-id");trailInfo[e].marker.openPopup()}function a(t){r.closePopup(),h.show(),g.hideOnAuto()}var s=[[51.4486598,-2.6009005],[51.4493936,-2.5805962]],r=L.map("map",{locateMeControl:!0}).fitBounds(s),l=L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>,Imagery &copy; <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"mapbox.streets",accessToken:"pk.eyJ1IjoicmljaGFyZHRob21hcyIsImEiOiJjaWZ1c2ZtZGUwMjA1dDZtN2t6amZ4cnRkIn0.2fVjrwFijZV-R6scDpeUQA"}).addTo(r),c=L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>,Imagery &copy; <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"mapbox.streets-satellite",accessToken:"pk.eyJ1IjoicmljaGFyZHRob21hcyIsImEiOiJjaWZ1c2ZtZGUwMjA1dDZtN2t6amZ4cnRkIn0.2fVjrwFijZV-R6scDpeUQA"}),d={Map:l,Satellite:c};L.control.layers(d).addTo(r)._expand(),L.control.scale().addTo(r),L.control.defaultExtent().addTo(r);var h=L.control.sidebar("sidebarL",{closeButton:!0,position:"left",autoPan:!1});r.addControl(h),h.hideOnAuto=function(){document.getElementById("auto-hide-info-pane").checked&&h.hide()};var u=h.getContainer(),m=document.getElementById("info-pane-title"),p=u.getElementsByTagName("div"),f=document.getElementById("site-specific-link"),y=document.getElementById("site-link");e();var g=(L.control.button({position:"topright",text:"Nav Icon",title:"Select growing site",className:"leaflet-button-sitelist",callback:n}).addTo(r),L.control.sidebar("sidebarR",{closeButton:!0,position:"right",autoPan:!1}));r.addControl(g),r.on("click",function(){g.hideOnAuto()}),g.hideOnAuto=function(){g.isVisible()&&document.getElementById("auto-hide-site-selector").checked&&g.hide()},document.getElementById("sidebarR").style.display="inline",document.getElementById("intro-button").onclick=function(){g.hide(),e()};var b=document.getElementById("sidebarButtons");for(var _ in trailInfo){var v=document.createTextNode(trailInfo[_].fullname),k=document.createElement("button");k.setAttribute("data-loc-id",_),k.className="site-button",k.onclick=i,k.appendChild(v);var E=document.createElement("p");E.appendChild(k),b.appendChild(E)}return{map:r,leftSidebarHideOnAuto:h.hideOnAuto,rightSidebarHideOnAuto:g.hideOnAuto,showSiteDetails:o,moreInfo:a}}();trail.markers=function(t){function e(e){o?o.setLatLng(e):(o=L.circleMarker(e,{fillOpacity:.1,color:"red",weight:2,radius:30,clickable:!1}),o.addTo(t))}var o=null,n=L.icon({iconUrl:"img/leaf-green.png",shadowUrl:"img/leaf-shadow.png",iconSize:[19,48],shadowSize:[25,32],iconAnchor:[11,47],shadowAnchor:[2,31],popupAnchor:[-1,-38]}),i={color:"#008000",dashArray:"5, 5",weight:3,opacity:.65,title:"Recommended walking route"},a=45,s=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,r=s-2*a-40;r=r>300?300:r;var l=L.geoJson(trailGeoJson,{style:i,pointToLayer:function(t,o){var i=t.properties.name,s=o,l=trailInfo[i],c=L.marker(o,{icon:n,title:l.fullname});l.marker=c;var d=function(t){trail.leftSidebarHideOnAuto(),trail.rightSidebarHideOnAuto(),e(s),trail.showSiteDetails(t)};c.addEventListener("popupopen",function(){d(i)});var h=document.getElementById(i+"-info"),u="<strong>"+l.fullname+"</strong><br>"+l.summary;return h&&(u+="<div class='more-info-div'><button type='button' onclick='trail.moreInfo();')>More Information</button></div>"),c.bindPopup(u,{autoPanPadding:L.point(a,5),maxWidth:r}),c}});l.addTo(t)}(trail.map);